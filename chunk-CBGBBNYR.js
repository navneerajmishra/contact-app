import{Db as A,Eb as y,Mb as H,Q as v,T as W,W as M,a as s,b as u,c as U,d as S,ia as C,qa as $,r as E,ra as q,s as b}from"./chunk-XRAK5ADX.js";function L(t){let e=A(()=>t());return at(e)?new Proxy(t,{get(i,n){return n in e?($(i[n])||Object.defineProperty(i,n,{value:y(()=>i()[n]),configurable:!0}),L(i[n])):i[n]}}):t}var ct=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function at(t){if(t===null||typeof t!="object"||ut(t))return!1;let e=Object.getPrototypeOf(t);if(e===Object.prototype)return!0;for(;e&&e!==Object.prototype;){if(ct.includes(e.constructor))return!1;e=Object.getPrototypeOf(e)}return e===Object.prototype}function ut(t){return typeof t?.[Symbol.iterator]=="function"}var dt=new WeakMap,f=Symbol("STATE_SOURCE");function l(t,...e){t[f].update(i=>e.reduce((n,o)=>s(s({},n),typeof o=="function"?o(n):o),i)),pt(t)}function ft(t){return t[f]()}function lt(t){return dt.get(t[f])||[]}function pt(t){let e=lt(t);for(let i of e){let n=A(()=>ft(t));i(n)}}function J(...t){let e=[...t],i=typeof e[0]=="function"?{}:e.shift(),n=e;return(()=>{class r{constructor(){let a=n.reduce((K,rt)=>rt(K),yt()),{stateSignals:p,props:j,methods:m,hooks:it}=a,O=s(s(s({},p),j),m);this[f]=a[f];for(let K of Reflect.ownKeys(O))this[K]=O[K];let{onInit:B,onDestroy:F}=it;B&&B(),F&&M(C).onDestroy(F)}static \u0275fac=function(p){return new(p||r)};static \u0275prov=v({token:r,factory:r.\u0275fac,providedIn:i.providedIn||null})}return r})()}function yt(){return{[f]:q({}),stateSignals:{},props:{},methods:{},hooks:{}}}function x(t,...e){let i=typeof t=="function"?[t,...e]:e;return n=>i.reduce((o,r)=>r(o),n)}function ht(t){return e=>{let i=t(s(s(s({[f]:e[f]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(i),u(s({},e),{props:s(s({},e.props),i)})}}function N(t){return ht(t)}function V(t){return e=>{let i=s(s(s({[f]:e[f]},e.stateSignals),e.props),e.methods),n=typeof t=="function"?t(i):t,o=r=>{let c=n[r],a=e.hooks[r];return c?()=>{a&&a(),c(i)}:a};return u(s({},e),{hooks:{onInit:o("onInit"),onDestroy:o("onDestroy")}})}}function z(t){return e=>{let i=t(s(s(s({[f]:e[f]},e.stateSignals),e.props),e.methods));return Reflect.ownKeys(i),u(s({},e),{methods:s(s({},e.methods),i)})}}function R(t){return e=>{let i=typeof t=="function"?t():t,n=Reflect.ownKeys(i);e[f].update(r=>s(s({},r),i));let o=n.reduce((r,c)=>{let a=y(()=>e[f]()[c]);return u(s({},r),{[c]:L(a)})},{});return u(s({},e),{stateSignals:s(s({},e.stateSignals),o)})}}var d=function(t){return t[t.None=0]="None",t[t.Entities=1]="Entities",t[t.Both=2]="Both",t}(d||{}),mt=t=>t.id;function _(t){return t?.selectId??mt}function g(t){let e=t?.collection,i=e===void 0?"entityMap":`${e}EntityMap`,n=e===void 0?"ids":`${e}Ids`,o=e===void 0?"entities":`${e}Entities`;return{entityMapKey:i,idsKey:n,entitiesKey:o}}function w(t,e){return{entityMap:s({},t[e.entityMapKey]),ids:[...t[e.idsKey]]}}function I(t,e,i){switch(i){case d.Both:return{[e.entityMapKey]:t.entityMap,[e.idsKey]:t.ids};case d.Entities:return{[e.entityMapKey]:t.entityMap};default:return{}}}function G(t,e,i,n=!1){let o=i(e);return t.entityMap[o]?d.None:(t.entityMap[o]=e,n?t.ids.unshift(o):t.ids.push(o),d.Both)}function Mt(t,e,i,n=!1){let o=d.None;for(let r of e){let c=G(t,r,i,n);c===d.Both&&(o=c)}return o}function gt(t,e,i,n=!0){let o=i(e);return t.entityMap[o]?(t.entityMap[o]=n?e:s(s({},t.entityMap[o]),e),d.Entities):(t.entityMap[o]=e,t.ids.push(o),d.Both)}function St(t,e){let i=Array.isArray(e)?e:t.ids.filter(o=>e(t.entityMap[o])),n=d.None;for(let o of i)t.entityMap[o]&&(delete t.entityMap[o],n=d.Both);return n===d.Both&&(t.ids=t.ids.filter(o=>o in t.entityMap)),n}function Et(t,e,i,n){let o=Array.isArray(e)?e:t.ids.filter(a=>e(t.entityMap[a])),r,c=d.None;for(let a of o){let p=t.entityMap[a];if(p){let j=typeof i=="function"?i(p):i;t.entityMap[a]=s(s({},p),j),c=d.Entities;let m=n(t.entityMap[a]);m!==a&&(t.entityMap[m]=t.entityMap[a],delete t.entityMap[a],r=r||{},r[a]=m)}}return r&&(t.ids=t.ids.map(a=>r[a]??a),c=d.Both),c}function k(t,e){let i=_(e),n=g(e);return o=>{let r=w(o,n),c=G(r,t,i);return I(r,n,c)}}function Q(t,e){let i=_(e),n=g(e);return o=>{let r=w(o,n),c=Mt(r,t,i);return I(r,n,c)}}function T(t,e){let i=g(e);return n=>{let o=w(n,i),r=St(o,[t]);return I(o,i,r)}}function D(t,e){let i=_(e),n=g(e);return o=>{let r=w(o,n),c=Et(r,[t.id],t.changes,i);return I(r,n,c)}}function X(t,e){let i=_(e),n=g(e);return o=>{let r=w(o,n),c=gt(r,t,i,!1);return I(r,n,c)}}function Y(t){let{entityMapKey:e,idsKey:i,entitiesKey:n}=g(t);return x(R({[e]:{},[i]:[]}),N(o=>({[n]:y(()=>{let r=o[e]();return o[i]().map(a=>r[a])})})))}var Z=new W("API URL");var tt=(()=>{class t{constructor(){}#t=M(H);#e=M(Z);getAllContacts(){return this.#t.get(this.#e).pipe(b(i=>i.map(j=>{var m=j,{first_name:n,last_name:o,job_title:r,created_on:c,phone:a}=m,p=U(m,["first_name","last_name","job_title","created_on","phone"]);return u(s({},p),{firstName:n,lastName:o,jobTitle:r,createdOn:c,phone:this.getPhoneNumber(a)})})))}createContact(i){return this.#t.post(this.#e,JSON.stringify(i)).pipe(b(n=>u(s({},n),{firstName:n.first_name,lastName:n.last_name,jobTitle:n.job_title,createdOn:n.created_on,phone:this.getPhoneNumber(n.phone)})))}updateContact(i,n){return this.#t.put(`${this.#e}/${i}`,JSON.stringify(n)).pipe(b(o=>u(s({},o),{firstName:o.first_name,lastName:o.last_name,jobTitle:o.job_title,createdOn:o.created_on,phone:this.getPhoneNumber(o.phone)})))}deleteContact(i){return this.#t.delete(`${this.#e}/${i}`).pipe(b(n=>u(s({},n),{firstName:n.first_name,lastName:n.last_name,jobTitle:n.job_title,createdOn:n.created_on,phone:this.getPhoneNumber(n.phone)})))}getPhoneNumber(i){let[n,o]=i?.split("x");return{number:(n??"").trim(),extension:(o??"").trim()}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function et(){return{requestStatus:"pending"}}function nt(){return{requestStatus:"fulfilled"}}function P(t){return{requestStatus:{error:t}}}function ot(){return x(R({requestStatus:"idle"}),N(({requestStatus:t})=>({isPending:y(()=>t()==="pending"),isFulfilled:y(()=>t()==="fulfilled"),error:y(()=>{let e=t();return typeof e=="object"?e.error:null})})))}var h={entity:void 0,collection:"contact",selectId:t=>t.id},Yt=J({providedIn:"root"},Y(h),ot(),z((t,e=M(tt))=>({loadAll(){return S(this,null,function*(){l(t,et());let n=yield E(e.getAllContacts());l(t,Q(n,h),nt())})},optimisticCreate(n){return S(this,null,function*(){let o=n.id??crypto.randomUUID(),r=u(s({},n),{id:o});l(t,k(r,h));try{let c=yield E(e.createContact(u(s({},r),{first_name:r.firstName,last_name:r.lastName,job_title:r.jobTitle,created_on:r.createdOn,phone:r.phone.number})));c?.id&&c.id!==o&&l(t,D({id:o,changes:{id:c.id}},h))}catch(c){throw l(t,T(o,h),P("Failed to create contact")),c}})},optimisticUpdate(n,o){return S(this,null,function*(){let r=t.contactEntityMap()[n];l(t,X(o,h));try{yield E(e.updateContact(n,u(s({},o),{first_name:o.firstName,last_name:o.lastName,job_title:o.jobTitle,created_on:o.createdOn,phone:o.phone.number})))}catch(c){throw l(t,D({id:n,changes:r},h),P("Failed to update contact")),c}})},optimisticDelete(n){return S(this,null,function*(){let o=t.contactEntityMap()[n];l(t,T(n,h));try{yield E(e.deleteContact(n))}catch(r){throw l(t,k(o,h)),r}})}})),V({onInit({loadAll:t}){t()}}));export{Z as a,Yt as b};
