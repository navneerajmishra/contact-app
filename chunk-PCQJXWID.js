import{a as P,n as M,o as A}from"./chunk-IBIPXLCD.js";import{c as j}from"./chunk-KYY6AEEQ.js";import{d as D,f as H,h as R}from"./chunk-VHMHPLZL.js";import{Ca as g,Eb as m,Ma as S,Qa as w,V as d,Xa as h,_a as x,aa as r,ba as a,c as b,cb as u,db as C,eb as y,gb as _,hb as f,ib as s,lb as v,pb as L,qa as p,qb as T,rb as O,sb as V,tb as k,ub as N}from"./chunk-O7LGMGVH.js";var z=(o,c)=>{let e=[];for(let i=0;i<o.length;i++){let t=c(o[i],i);t!==void 0&&e.push(t)}return e},B=(o,c,e="asc")=>o.slice().sort((i,t)=>{let n=String(i[c]).toLowerCase(),l=String(t[c]).toLowerCase();return n<l?e==="asc"?-1:1:n>l?e==="asc"?1:-1:0});function q(o,c){if(o&1){let e=_();u(0,"ca-table",4),O("searchStringChange",function(t){r(e);let n=s();return T(n.searchString,t)||(n.searchString=t),a(t)}),f("rowClick",function(t){r(e);let n=s();return a(n.onRowClick(t))})("pageChange",function(t){r(e);let n=s();return a(n.onPageChange(t))})("searchChange",function(t){r(e);let n=s();return a(n.onSearchChange(t))})("sortChange",function(t){r(e);let n=s();return a(n.onSortChange(t))})("delete",function(t){r(e);let n=s();return a(n.onDelete(t))})("update",function(t){r(e);let n=s();return a(n.onUpdate(t))}),C()}if(o&2){let e=s(),i=N(0);h("key","id")("fields",e.columns())("values",i)("totalRecords",e.filteredContactList().length)("paginationOptions",e.paginationOptions())("sortOption",e.sortOption()),L("searchString",e.searchString)}}var ee=(()=>{class o{#i;#t;#e;#o;#r;constructor(){this.#i=d(j),this.#t=d(R),this.#e=d(H),this.#o=d(A),this.columns=p([{id:"id",name:"Id",type:"string",isHidden:!0,isSortable:!1},{id:"name",name:"Name",type:"string",isHidden:!1,isSortable:!0},{id:"company",name:"Company",type:"string",isHidden:!1,isSortable:!1},{id:"phone",name:"Phone",type:"string",isHidden:!1,isSortable:!1},{id:"email",name:"email",type:"string",isHidden:!1,isSortable:!0},{id:"jobTitle",name:"Job title",type:"string",isHidden:!1,isSortable:!1},{id:"createdOn",name:"Created On",type:"date",isHidden:!0,isSortable:!1}]),this.searchString=p(""),this.paginationOptions=p({pageNumber:1,pageSize:10}),this.sortOption=p({field:"name",order:"asc"}),this.filteredContactList=m(()=>{let e=this.#i.contactEntities(),i=this.searchString().toLowerCase().trim();return z(e,t=>{let n=[t.firstName,t.lastName,t.email];return!i||n.some(l=>l?.toLowerCase().includes(i))?{id:t.id,company:t.company??"",jobTitle:t.jobTitle??"",name:`${t.firstName} ${t.lastName??""}`,phone:t.phone.extension?`${t.phone.number} x${t.phone.extension}`:t.phone.number,email:t.email}:void 0})}),this.#r=m(()=>{let e=this.sortOption();return B(this.filteredContactList(),e.field,e.order)}),this.paginatedContacts=m(()=>{let{pageNumber:e,pageSize:i}=this.paginationOptions();return this.#r().slice((e-1)*i,e*i)}),this.loadingStatus=this.#i.requestStatus,this.#e.queryParamMap.subscribe(e=>{let i=e.get("pn")??1,t=e.get("ps")??10,n=e.get("so");this.paginationOptions.set({pageNumber:Number(i),pageSize:Number(t)}),this.sortOption.update(l=>({field:e.get("sb")??l.field,order:n??l.order})),this.searchString.set(e.get("ss")??"")})}createContact(){this.#t.navigate(["new"],{relativeTo:this.#e})}onRowClick(e){this.#t.navigate([e.data.id],{relativeTo:this.#e})}onUpdate(e){this.#t.navigate(["edit",e.data.id],{relativeTo:this.#e})}onPageChange(e){this.#n({pn:e})}onSearchChange(e){this.#n({ss:e?.trim()})}onSortChange(e){this.#n({sb:e.field,so:e.order})}onDelete(e){return b(this,null,function*(){(yield this.#o.confirm("Are you sure you want to delete this contact?",e.data.name))&&this.#i.optimisticDelete(e.data.id)})}#n(e){this.#t.navigate([],{relativeTo:this.#e,queryParams:e,queryParamsHandling:"merge"})}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["ca-contact-list"]],hostAttrs:[1,"flex","flex-col","gap-4","h-full"],decls:7,vars:3,consts:[["role","region","aria-label","Contact Actions",1,"flex","flex-row-reverse"],["type","button","aria-label","Create new contact",1,"text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","me-2","mb-2","focus:outline-none",3,"click"],[3,"key","fields","values","totalRecords","paginationOptions","sortOption","searchString"],["aria-live","polite",3,"show"],[3,"searchStringChange","rowClick","pageChange","searchChange","sortChange","delete","update","key","fields","values","totalRecords","paginationOptions","sortOption","searchString"]],template:function(i,t){if(i&1){let n=_();V(0)(1),u(2,"div",0)(3,"button",1),f("click",function(){return r(n),a(t.createContact())}),v(4," Create new "),C()(),w(5,q,1,7,"ca-table",2),y(6,"ca-loading-indicator",3)}if(i&2){k(t.paginatedContacts());let n=t.loadingStatus();g(5),x(n==="fulfilled"?5:-1),g(),h("show",n==="pending")}},dependencies:[D,M,P],encapsulation:2,changeDetection:0})}}return o})();export{ee as ContactListComponent};
